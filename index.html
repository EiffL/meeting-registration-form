<!DOCTYPE html>
<html lang="en" >

<head>
  <meta charset="UTF-8">
  <title>DESC registration form</title>


  <link rel='stylesheet prefetch' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.css'>
  <link rel='stylesheet prefetch' href='https://fonts.googleapis.com/css?family=Raleway:400,400i,700'>

  <style>

body {
  margin-bottom: 0px; /* Margin bottom by footer height */
}
.footer {
  margin-top: 40px;
  width: 100%;
  background-color: #f5f5f5;
}

#badge span {
  font-family: "Raleway";
}

#badge {
  position: relative;
  margin: 0 auto;
  width: 4in;
  height: 3in;
  border: 1px solid black;
}

#badge div {
  white-space: nowrap;
  text-align: center;
  width: 100%;
  position: absolute;
  line-height: 0.8;
}
#lname-d,
#sname-d {
  font-weight: bold;
}
#lname-d {
  font-size: 68pt;
  bottom: 2.05in;
}
#sname-d {
  font-size: 26pt;
  font-weight: bold;
  bottom: 1.55in;
}
#affili-d,
#pronoun-d {
  font-size: 22pt;
  bottom: 1.08in;
}
#pronoun-d {
  font-style: italic;
  bottom: 0.64in;
}
#event-d,
#location-d {
  font-size: 7pt;
  bottom: 0.29in;
  left: 0.025in;
}
#location-d {
  bottom: 0.15in;
}

#logo1 {
  width: 92px !important;
  height: 61px;
  background-image: url("https://raw.githubusercontent.com/LSSTDESC/name-tag-guru/master/web-static/desc-logo.png");
  bottom: 0.02in;
  left: 0.1in;
}

#logo2 {
  width: 64px !important;
  height: 22px;
  background-image: url("https://raw.githubusercontent.com/LSSTDESC/name-tag-guru/master/web-static/lsstc-logo.png");
  bottom: 0.15in;
  right: 0.2in;
}
  </style>

</head>

<body>

  <div class="container">
  <h1>LSST DESC registration form </h1>
  Please fill-in the following form to register for the DESC meeting
  <br>
  <br>
  <form action="" method="POST" id="main_form">
    <div class="form-row">
      <div class="form-group col-md-6">
        <label for="first_name">First Name</label>
        <input type="text" class="form-control" name="first_name" id="first_name" placeholder="First Name" maxlength="100" required>
      </div>
      <div class="form-group col-md-6">
        <label for="last_name">Last Name</label>
        <input type="text" class="form-control" name="last_name" id="last_name" placeholder="Last Name" maxlength="100" required>
      </div>
    </div>
    <div class="form-group">
      <label for="email">Email</label>
      <input type="email" class="form-control" name="email" id="email" placeholder="Email" maxlength="100" required>
        <div class="invalid-feedback">
          Email already registered.
        </div>
    </div>
    <div class="form-group">
      <label for="affili">Affiliation</label>
      <input type="text" class="form-control" name="affiliation" id="affili" placeholder="Affiliation" maxlength="100" required>
    </div>

    <div class="form-group">
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="contact" name="contact">
        <label class="form-check-label" for="contact">
        Check if you do NOT wish to be considered for the role of meeting contact person.
         </label>
       </div>
      </div>

    <div class="form-group">
      <div class="form-check">
        <input class="form-check-input" type="checkbox" id="visa" name="visa">
        <label class="form-check-label" for="visa">
        Check if you require an invitation letter for visa applications.
         </label>
       </div>
      </div>

    <hr>
    <h5>Badge information</h5>
    <br>
    <div class="row">
      <div class="col-sm">
        <div class="form-group">
          <label for="lname">Large-font name</label>
          <input type="text" class="form-control" name="lname" id="lname" placeholder="optional, defaults to first name" maxlength="100">
        </div>
        <div class="form-group">
          <label for="sname">Small-font name</label>
          <input type="text" class="form-control" name="sname" id="sname" placeholder="optional, defaults to last name" maxlength="100">
        </div>
        <div class="form-group">
          <label for="pronoun">Third-person pronoun</label>
          <input type="text" class="form-control" name="pronoun" id="pronoun" placeholder="e.g. she/her, he/his, they/their..." required maxlength="100">
          <small id="inputPronounHelp" class="form-text text-muted">Third-pronoun you want people to use to refer to you.
       <a href="https://confluence.slac.stanford.edu/display/LSSTDESC/Personal+Pronouns" target="_top">Why ask for pronouns ?</a></small>
        </div>
      </div>
      <div class="col-sm">
        <div id="badge">
          <div id="lname-d">
            <span id="lname-s"></span>
          </div>
          <div id="sname-d">
            <span id="sname-s"></span>
          </div>
          <div id="affili-d">
            <span id="affili-s"></span>
          </div>
          <div id="pronoun-d">
            <span id="pronoun-s"></span>
          </div>
          <div id="event-d">
            <span id="event-s">Collaboration Meeting, July 23-27, 2018 </span>
          </div>
          <div id="location-d">
            <span id="location-s">Carnegie Mellon University</span>
          </div>
          <div id="logo1" class="logo"></div>
          <div id="logo2" class="logo"></div>
        </div>
      </div>
    </div>

    <hr>

    <h5>Logistics</h5>
    <div class="form-group">
      <label for="inputAttendance">What days will you attend ?</label>
      <div id="Attendance">
      <div class="form-check form-check-inline" id="inputAttendance">
        <input class="form-check-input" type="checkbox" name="attend_mon" id="attend_mon">
        <label class="form-check-label" for="attend_mon">Monday (DE School)</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" name="attend_tue" id="attend_tue">
        <label class="form-check-label" for="attend_tue">Tuesday</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox"  name="attend_wed" id="attend_wed">
        <label class="form-check-label" for="attend_wed">Wednesday</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox"  name="attend_thu" id="attend_thu">
        <label class="form-check-label" for="attend_thu">Thursday</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" name="attend_fri" id="attend_fri">
        <label class="form-check-label" for="attend_fri">Friday (Hack day)</label>
      </div>
        </div>
    </div>

    <div class="form-group">
      <label for="dinnerOptions">Will you attend the conference dinner ?</label>
      <div class="form-row align-items-center" id="dinnerOptions">

        <div class="col-md-3">
          <div class="form-check form-check-inline mb-2">
            <input class="form-check-input" type="radio" name="dinner" id="dinnerTrue" value="yes" required>
            <label class="form-check-label" for="inlineRadio1">Yes</label>
          </div>
          <div class="form-check form-check-inline mb-2">
            <input class="form-check-input" type="radio" name="dinner" id="dinnerFalse" value="no">
            <label class="form-check-label" for="inlineRadio2">No</label>
          </div>
        </div>
        <div class="col-md-3">
          <label for="dinner_guests">Additional guests</label>
          <select class="form-control-inline" id="dinner_guests" name="dinner_guests">
      <option>0</option>
      <option>1</option>
      <option>2</option>
      <option>3</option>
      <option>4</option>
    </select>
        </div>
        <div class="col-md-6">
          <input type="text" class="form-control" id="dinner_diet" name="dinner_diet" maxlength="256" placeholder="Please indicate any dietary restrictions">
        </div>
      </div>
    </div>

    <div class="form-group">
       <label for="carpooling">Will you be driving a car during the meeting and can help with carpooling?</label>
        <div class="form-check form-check-inline mb-2" id="carpooling">
            <input class="form-check-input" type="radio" name="carpool" id="carTrue" value="yes" required>
            <label class="form-check-label" for="inlineRadio1">Yes</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="carpool" id="carFalse" value="no">
            <label class="form-check-label" for="inlineRadio2">No</label>
          </div>
    </div>

    <hr>
    <div class="form-group">
      <div class="form-check">
        <input class="form-check-input" type="checkbox" name="code_of_conduct" id="code_of_conduct" required>
        <label class="form-check-label" for="code_of_conduct">
        I have read, and will abide by, the DESC <a href="http://lsstdesc.org/sites/default/files/LSST_DESC_Professional_Conduct.pdf" target="_top">Code of Conduct</a>.
      </label>
      </div>
    </div>
    <button type="submit" class="btn btn-primary">Register</button>
    <!-- Noscript content for added SEO -->
    <noscript><a href="https://www.eventbrite.com/e/cmu-desc-meeting-registration-44601052950" rel="noopener noreferrer" target="_blank"></noscript>
    <!-- You can customize this button any way you like -->
    <button id="eventbrite-widget-modal-trigger-44601052950" type="button">Buy Tickets</button>
    <noscript></a>Buy Tickets on Eventbrite</noscript>

    <script src="https://www.eventbrite.com/static/widgets/eb_widgets.js"></script>

    <script type="text/javascript">
        var exampleCallback = function() {
            console.log('Order complete!');
        };

        window.EBWidgets.createWidget({
            widgetType: 'checkout',
            eventId: '44601052950',
            modal: true,
            modalTriggerElementId: 'eventbrite-widget-modal-trigger-44601052950',
            onOrderComplete: exampleCallback
        });
    </script>

    <input type="hidden" name="secret" id="secret" value=""/>
  </form>
</div>

<!-- Modal Warning-->
  <div class="modal fade" id="backendModal" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Invalid registration URL</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>The URL for this form does not contain a valid registration link.
            Please contact the LOC for a valid registration URL.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>


<footer class="footer">
    <div class="container">
      <dl class="row">
        <span class="text-muted">
  <p class="lead">Privacy notice</p>
  <p>Your <mark>first name, last name, and affiliation will appear on a public webpage</mark> associated with the meeting website. Your badge names, pronoun(s), and your affiliation will appear on your badge.  Your email will be used to contact you when necessary. All data collected here may be shared with LSST DESC members who are on the LOC, the SOC, the Meetings Committee, the Collaboration Council, and the Management Team.</p>
         <div class="col-md-12">
          <!--Footer Bottom-->
          <p class="text-md-center"><small>This page uses the <a href="https://github.com/LSSTDESC/name-tag-guru/" target="_top">badge template</a> designed by <a href="https://yymao.github.com/" target="_top">Yao-Yuan Mao</a>. The logos appearing on the badge belong to the <a href="http://lsstdesc.org/" target="_top">LSST Dark Energy Science Collaboration</a> and the <a href="https://www.lsstcorporation.org/" target="_top">LSST Corporation</a>.</small></p>
        </div></span>
</dl>
  </div>
</footer>

  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/js/bootstrap.min.js'></script>
  <script>
  var getUrlParameter = function getUrlParameter(sParam) {
    var sPageURL = decodeURIComponent(window.location.search.substring(1)),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

    for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
            return sParameterName[1] === undefined ? true : sParameterName[1];
        }
    }
};
var backend = getUrlParameter('backend');
var secret  = getUrlParameter('secret');

$(function(){
  // Disable the form if the required info about backend server is missing
  if((backend === undefined) || (secret === undefined)){
    $("#main_form :input").prop('disabled', true);
    $('#backendModal').modal({show: true});
  }
  $("#main_form").attr('action', backend+'/register');
  $("#secret").attr('value', secret);
});

$("#email").change(function(){
    $.post(backend+"/check_email",
            {email: $(this).val(),
             secret: secret},
            function(data, status){
              var d = document.getElementById("email");
              if (status === "success"){
                if(data === "Ok"){
                  d.setCustomValidity("");
                  d.classList.remove('is-invalid');
                }else{
                  d.setCustomValidity("Already registered.");
                  d.classList.add('is-invalid');
                }

              }else{
                  // Server is unavailable...
                  // make sure we don't block the form at this stage
                  d.setCustomValidity("");
                  d.classList.remove('is-invalid');
                }
              console.log("Data: " + data + "\nStatus: " + status);
            });
});

$("#dinnerOptions").change(function(){
   selected_value = $("input[name='dinner']:checked").val();
  if(selected_value === "yes"){
    $("#dinner_guests").prop('disabled', false);
    $("#dinner_diet").prop('disabled', false);
  }else if(selected_value === "no"){
    $("#dinner_guests").prop('disabled', true);
    $("#dinner_guests").val(0);
    $("#dinner_diet").prop('disabled', true);
    $("#dinner_diet").val("");
  }
});

$("input").keyup(function() {
  var target = $("#" + $(this).attr("id") + "-s");
  target.text($(this).val());
  target.css("font-size", "100%");
  var badge = $("#badge");
  var scale = badge.width() / target.width();
  if (scale < 1) target.css("font-size", (scale * 100).toString() + "%");
});
</script>

</body>

</html>
