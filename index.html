<!DOCTYPE html>
<html lang="en" >

<head>
  <meta charset="UTF-8">
  <title>DESC registration form</title>


  <link rel='stylesheet prefetch' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/css/bootstrap.css'>
  <link rel='stylesheet prefetch' href='https://fonts.googleapis.com/css?family=Raleway:400,400i,700'>

  <style>
#badge span {
  font-family: "Raleway";
}

#badge {
  position: relative;
  height: 3in;
  border: 1px solid black;
}

#badge div {
  white-space: nowrap;
  text-align: center;
  width: 100%;
  position: absolute;
  line-height: 0.8;
}
#lname-d,
#sname-d {
  font-weight: bold;
}
#lname-d {
  font-size: 68pt;
  bottom: 2.05in;
}
#sname-d {
  font-size: 26pt;
  font-weight: bold;
  bottom: 1.55in;
}
#affili-d,
#pronoun-d {
  font-size: 22pt;
  bottom: 1.08in;
}
#pronoun-d {
  font-style: italic;
  bottom: 0.64in;
}
#event-d,
#location-d {
  font-size: 7pt;
  bottom: 0.29in;
  left: 0.025in;
}
#location-d {
  bottom: 0.15in;
}

#logo1 {
  width: 92px !important;
  height: 61px;
  background-image: url("https://raw.githubusercontent.com/LSSTDESC/name-tag-guru/master/web-static/desc-logo.png");
  bottom: 0.02in;
  left: 0.1in;
}

#logo2 {
  width: 64px !important;
  height: 22px;
  background-image: url("https://raw.githubusercontent.com/LSSTDESC/name-tag-guru/master/web-static/lsstc-logo.png");
  bottom: 0.15in;
  right: 0.2in;
}
  </style>

</head>

<body>

  <div class="container">
  <h1>LSST DESC registration form </h1>
  Please fill-in the following form to register for the DESC meeting
  <br>
  <br>
  <form action="" method="POST" id="main_form">
    <div class="form-row">
      <div class="form-group col-md-6">
        <label for="first_name">First Name</label>
        <input type="text" class="form-control" name="first_name" id="first_name" placeholder="First Name" required>
      </div>
      <div class="form-group col-md-6">
        <label for="last_name">Last Name</label>
        <input type="text" class="form-control" name="last_name" id="last_name" placeholder="Last Name" required>
      </div>
    </div>
    <div class="form-group">
      <label for="email">Email</label>
      <input type="email" class="form-control" name="email" id="email" placeholder="Email" required>
        <div class="invalid-feedback">
          Email already registered.
        </div>
    </div>
    <div class="form-group">
      <label for="affili">Affiliation</label>
      <input type="text" class="form-control" name="affiliation" id="affili" placeholder="Affiliation" required>
    </div>

    <hr>
    <h5>Badge information</h5>
    <br>
    <div class="row">
      <div class="col-sm">
        <div class="form-group">
          <label for="lname">Large-font name</label>
          <input type="text" class="form-control" name="lname" id="lname" placeholder="optional, defaults to first name">
        </div>
        <div class="form-group">
          <label for="sname">Small-font name</label>
          <input type="text" class="form-control" name="sname" id="sname" placeholder="optional, defaults to last name">
        </div>
        <div class="form-group">
          <label for="pronoun">Third-person pronoun</label>
          <input type="text" class="form-control" name="pronoun" id="pronoun" placeholder="e.g. she/her, he/his, they/their..." required>
          <small id="inputPronounHelp" class="form-text text-muted">Third-pronoun you want people to use to refer to you.
       <a href="https://confluence.slac.stanford.edu/display/LSSTDESC/Personal+Pronouns">Why ask for pronouns ?</a></small>
        </div>
      </div>
      <div class="col-sm">
        <div id="badge">
          <div id="lname-d">
            <span id="lname-s"></span>
          </div>
          <div id="sname-d">
            <span id="sname-s"></span>
          </div>
          <div id="affili-d">
            <span id="affili-s"></span>
          </div>
          <div id="pronoun-d">
            <span id="pronoun-s"></span>
          </div>
          <div id="event-d">
            <span id="event-s">Collaboration Meeting, July 23-27, 2018 </span>
          </div>
          <div id="location-d">
            <span id="location-s">Carnegie Mellon University</span>
          </div>
          <div id="logo1" class="logo"></div>
          <div id="logo2" class="logo"></div>
        </div>
      </div>
    </div>

    <hr>

    <h5>Logistics</h5>
    <div class="form-group">
      <label for="inputAttendance">What days will you attend ?</label>
      <div id="Attendance">
      <div class="form-check form-check-inline" id="inputAttendance">
        <input class="form-check-input" type="checkbox" name="attend_mon" id="attend_mon">
        <label class="form-check-label" for="attend_mon">Monday (DE School)</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" name="attend_tue" id="attend_tue">
        <label class="form-check-label" for="attend_tue">Tuesday</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox"  name="attend_wed" id="attend_wed">
        <label class="form-check-label" for="attend_wed">Wednesday</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox"  name="attend_thu" id="attend_thu">
        <label class="form-check-label" for="attend_thu">Thursday</label>
      </div>
      <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" name="attend_fri" id="attend_fri">
        <label class="form-check-label" for="attend_fri">Friday (Hack day)</label>
      </div>
        </div>
    </div>
    <hr>
    <div class="form-group">
      <div class="form-check">
        <input class="form-check-input" type="checkbox" name="code_of_conduct" id="code_of_conduct" required>
        <label class="form-check-label" for="code_of_conduct">
        I have read, and will abide by, the DESC Meetings <a href="http://lsst-desc.org/sites/default/files/DESCProfessionalConductPolicies-2.pdf">Code of Conduct</a>.
      </label>
      </div>
    </div>
    <button type="submit" class="btn btn-primary">Register</button>
    <input type="hidden" name="secret" id="secret" value=""/>
  </form>
</div>
<!-- Modal Warning-->
  <div class="modal fade" id="backendModal" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Invalid registration URL</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>The URL for this form does not contain a valid registration link.
            Please contact the LOC for a valid registration URL.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>

  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0/js/bootstrap.min.js'></script>
  <script>
  var getUrlParameter = function getUrlParameter(sParam) {
    var sPageURL = decodeURIComponent(window.location.search.substring(1)),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

    for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
            return sParameterName[1] === undefined ? true : sParameterName[1];
        }
    }
};
var backend = getUrlParameter('backend');
var secret  = getUrlParameter('secret');

$(function(){
  // Disable the form if the required info about backend server is missing
  if((backend === undefined) || (secret === undefined)){
    $("#main_form :input").prop('disabled', true);
    $('#backendModal').modal({show: true});
  }
  $("#main_form").attr('action', backend+'/register');
  $("#secret").attr('value', secret);
});

$("#email").change(function(){
    $.post(backend+"/check_email",
            {email: $(this).val(),
             secret: secret},
            function(data, status){
              var d = document.getElementById("email");
              if (status === "success"){
                if(data === "Ok"){
                  d.setCustomValidity("");
                  d.classList.remove('is-invalid');
                }else{
                  d.setCustomValidity("Already registered.");
                  d.classList.add('is-invalid');
                }

              }else{
                  // Server is unavailable...
                  // make sure we don't block the form at this stage
                  d.setCustomValidity("");
                  d.classList.remove('is-invalid');
                }
              console.log("Data: " + data + "\nStatus: " + status);
            });
});

$("input").keyup(function() {
  var target = $("#" + $(this).attr("id") + "-s");
  target.text($(this).val());
  target.css("font-size", "100%");
  var badge = $("#badge");
  var scale = badge.width() / target.width();
  if (scale < 1) target.css("font-size", (scale * 100).toString() + "%");
});
</script>


</body>

</html>
